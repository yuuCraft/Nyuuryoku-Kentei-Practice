<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>入力検定練習ソフト V1.50 Web</title>

<style>
:root{
  --bg:#f3f4f6;
  --card:#ffffff;
  --text:#111;
  --accent:#2563eb;
  --danger:#dc2626;
  --border:#d1d5db;
  --shadow:0 10px 25px rgba(0,0,0,.08);
  --ok:#16a34a;
  --miss:#dc2626;
  --none:#9ca3af;
}

/* Win11 Dark */
.dark{
  --bg:#0f1115;
  --card:#1c1f26;
  --text:#e5e7eb;
  --accent:#60a5fa;
  --border:#2a2f37;
  --shadow:0 10px 30px rgba(0,0,0,.6);
}

*{box-sizing:border-box}
html,body{
  margin:0;
  background:var(--bg);
  font-family:system-ui,-apple-system,"Segoe UI",sans-serif;
  color:var(--text);
}

/* Header */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:1rem;
  border-bottom:1px solid var(--border);
  background:linear-gradient(#fafafa,#f0f0f0);
}
.dark header{
  background:linear-gradient(#1f2937,#111827);
}

h1{font-size:1.05rem;margin:0}

/* Layout */
.container{
  max-width:1100px;
  margin:1.5rem auto;
  padding:0 1rem;
}

.card{
  background:var(--card);
  border-radius:14px;
  box-shadow:var(--shadow);
  padding:1.2rem;
  margin-bottom:1rem;
}

/* Buttons */
button{
  border:1px solid var(--border);
  background:transparent;
  color:var(--text);
  padding:.55rem .9rem;
  border-radius:8px;
  cursor:pointer;
}
button.primary{
  background:var(--accent);
  color:#fff;
  border-color:var(--accent);
}
button.danger{
  background:var(--danger);
  color:#fff;
  border-color:var(--danger);
}

/* Textarea */
textarea{
  width:100%;
  min-height:240px;
  resize:vertical;
  padding:1rem;
  border-radius:10px;
  border:1px solid var(--border);
  font-size:1rem;
  background:#fff;
  color:#111;
}
.dark textarea{
  background:#111827;
  color:#e5e7eb;
  border-color:#374151;
}

/* Grid */
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:1rem;
}
@media(max-width:800px){
  .grid{grid-template-columns:1fr}
}

/* Timer */
.timer{
  font-size:2.3rem;
  font-weight:800;
}

/* Compare */
.score{
  font-size:2.8rem;
  font-weight:800;
  text-align:center;
  color:var(--accent);
}

.diff{
  margin-top:.75rem;
  padding:.75rem;
  border-radius:8px;
  background:rgba(0,0,0,.05);
  font-family:monospace;
  white-space:pre-wrap;
}
.dark .diff{background:rgba(255,255,255,.05)}

.ok{color:var(--ok)}
.miss{color:var(--miss)}
.none{color:var(--none)}
</style>
</head>

<body>

<header>
  <h1>入力検定練習ソフト V1.50 Web</h1>
  <label>
    <input type="checkbox" id="darkToggle"> ダークモード
  </label>
</header>

<div class="container">

<div class="card">
  <button id="saveTxtBtn">txt保存</button>
  <button id="saveWebBtn">Web保存</button>
  <button id="lockBtn">ロック</button>
  <span id="lockState">未ロック</span>
  <button id="clearBtn" class="danger">削除</button>
</div>

<div class="card">
  <textarea id="inputArea" placeholder="ここに入力…"></textarea>
  <div style="margin-top:.5rem">
    文字数：<span id="chars">0</span>　
    行数：<span id="lines">0</span>
  </div>
</div>

<div class="grid">

<div class="card">
  <div class="timer" id="timerLabel">00:00:00</div>
  <input id="h" type="number" value="0" style="width:4rem">時
  <input id="m" type="number" value="1" style="width:4rem">分
  <input id="s" type="number" value="0" style="width:4rem">秒
  <div style="margin-top:.5rem">
    <button id="start" class="primary">開始</button>
    <button id="pause">停止</button>
    <button id="reset">リセット</button>
  </div>
</div>

<div class="card">
  <textarea id="refArea" placeholder="お手本文章"></textarea>
  <button id="compare" class="primary">比較</button>
  <div id="score" class="score">—</div>
  <div id="diff" class="diff"></div>
</div>

</div>
</div>

<script>
/* ===== DOM ===== */
const input = document.getElementById("inputArea");
const ref   = document.getElementById("refArea");
const chars = document.getElementById("chars");
const lines = document.getElementById("lines");

/* count */
function count(){
  chars.textContent = input.value.length;
  lines.textContent = input.value.split("\n").length;
}
input.addEventListener("input", count);
count();

/* save */
const KEY="typingTool";
saveWebBtn.onclick=()=>{
  localStorage.setItem(KEY,JSON.stringify({
    i:input.value,
    r:ref.value,
    d:document.documentElement.classList.contains("dark")
  }));
};
(()=>{const d=localStorage.getItem(KEY);
if(d){
  const j=JSON.parse(d);
  input.value=j.i||"";ref.value=j.r||"";
  if(j.d){document.documentElement.classList.add("dark");darkToggle.checked=true;}
  count();
}})();

/* dark */
darkToggle.onchange=e=>{
  document.documentElement.classList.toggle("dark",e.target.checked);
};

/* lock */
let lock=false;
lockBtn.onclick=()=>{
  lock=!lock;
  input.readOnly=lock;
  ref.readOnly=lock;
  lockState.textContent=lock?"ロック中":"未ロック";
};

/* clear */
clearBtn.onclick=()=>{
  if(confirm("削除しますか？")){
    input.value="";ref.value="";
    localStorage.removeItem(KEY);
    count();
  }
};

/* timer */
let rest=0,run=false,raf;
function fmt(ms){
  let t=Math.floor(ms/1000);
  return `${String(t/3600|0).padStart(2,"0")}:${String(t%3600/60|0).padStart(2,"0")}:${String(t%60).padStart(2,"0")}`;
}
function set(){
  rest=(+h.value*3600+ +m.value*60+ +s.value)*1000;
  timerLabel.textContent=fmt(rest);
}
["h","m","s"].forEach(i=>window[i].onchange=set);
set();
start.onclick=()=>{
  if(run)return;run=true;
  const end=performance.now()+rest;
  const tick=t=>{
    rest=Math.max(0,end-t);
    timerLabel.textContent=fmt(rest);
    if(rest>0) raf=requestAnimationFrame(tick);
    else run=false;
  };
  raf=requestAnimationFrame(tick);
};
pause.onclick=()=>{run=false;cancelAnimationFrame(raf)};
reset.onclick=()=>{run=false;set()};

/* compare visualize */
compare.onclick=()=>{
  const a=input.value,b=ref.value;
  let out="",miss=0;
  const len=Math.max(a.length,b.length);
  for(let i=0;i<len;i++){
    if(a[i]===b[i]) out+=`<span class="ok">${b[i]||" "}</span>`;
    else if(a[i]==null) out+=`<span class="none">${b[i]}</span>`,miss++;
    else out+=`<span class="miss">${b[i]||" "}</span>`,miss++;
  }
  diff.innerHTML=out;
  score.textContent=miss;
};
</script>

</body>
</html>
